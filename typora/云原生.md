# 云原生

## 云平台分类

## 服务架构变革

1. 分布式:拆分出多个功能模块,每个功能模块分布在不同的服务器上,完成整个系统的功能.
2. 集群:拆分出来的单个服务能力不够用了,需要进行复制成多个服务,多个服务一起提供服务.集群需要部署在不同的服务器上.
3. 微服务:分布式演进而来,以业务为单元直接进行了分库,分离.通过RPC进行调用.

## 云原生的12概念

## 其它概念

1. 蓝绿部署
   1. 蓝色稳定运行,让新的增加服务部署到绿环境,实验稳定转换成蓝环境.

## Docker 

### 隔离原理

1. 资源隔离与资源的限制.

### 故障排除

1. **kubectl get** - 显示资源列表

   - ```sh
     # kubectl get 资源类型
     
     #获取类型为Deployment的资源列表
     kubectl get deployments
     
     #获取类型为Pod的资源列表
     kubectl get pods
     
     #获取类型为Node的资源列表
     kubectl get nodes
     ```

   - ```sh
     # 查看所有名称空间的 Deployment
     kubectl get deployments -A
     kubectl get deployments --all-namespaces
     # 查看 kube-system 名称空间的 Deployment
     kubectl get deployments -n kube-system
     ```

   - ```sh
     #####并不是所有的对象都在名称空间中
     
     # 在名称空间里
     kubectl api-resources --namespaced=true
     
     # 不在名称空间里
     kubectl api-resources --namespaced=false
     ```

2. **kubectl describe** - 显示有关资源的详细信息

   - ```sh
     # kubectl describe 资源类型 资源名称
     
     #查看名称为nginx-XXXXXX的Pod的信息
     kubectl describe pod nginx-XXXXXX	
     
     #查看名称为nginx的Deployment的信息
     kubectl describe deployment my-nginx	
     ```

     

3. **kubectl logs** - 查看pod中的容器的打印日志（和命令docker logs 类似）

   - ```sh
     # kubectl logs Pod名称
     
     #查看名称为nginx-pod-XXXXXXX的Pod内的容器打印的日志
     #本案例中的 nginx-pod 没有输出日志，所以您看到的结果是空的
     kubectl logs -f nginx-pod-XXXXXXX
     ```

4. **kubectl exec** - 在pod中的容器环境内执行命令(和命令docker exec 类似)

   - ```sh
     # kubectl exec Pod名称 操作命令
     
     # 在名称为nginx-pod-xxxxxx的Pod中运行bash
     kubectl exec -it nginx-pod-xxxxxx /bin/bash
     
     ### 注意：新版1.21.0 提示这个命令会过期
     ```

5. **kubectl run**

   - ~~~sh
     ## kubectl run --help  也可以独立跑一个Pod
     kubectl run nginx --image=nginx
     ~~~

6. **kubectl expose**

   - ~~~sh
      kubectl expose deployment tomcat6 --port=8912 --target-port=8080 --type=NodePort
      
      ## --port：集群内访问service的端口 8912
      ## --target-port： pod容器的端口 8080
      ## --nodePort： 每个机器开发的端口 30403
      
      
      ## 进行验证
      kubectl get svc 
      curl ip:port 
      
      ## kubectl exec 进去pod修改，并测试负载均衡
     ~~~

7. 扩缩容

   - ~~~sh
     ## 扩展
     kubectl scale --replicas=3  deployment tomcat6
     
     #持续观测效果
     watch kubectl get pods -o wide
     ~~~

8. 升级与回滚

   - ~~~sh
     #应用升级: tomcat:alpine、tomcat:jre8-alpine
     kubectl set image deployment.apps/tomcat6 tomcat=tomcat:jre8-alpine #可以携带--record参数，记录变更
     
     
     ##回滚升级
     ### 查看历史记录
     kubectl rollout history deployment.apps/tomcat6
     kubectl rollout history deploy tomcat6
     
     ### 回滚到指定版本
     kubectl rollout undo deployment.apps/tomcat6 --to-revision=1
     kubectl rollout undo deploy tomcat6 --to-revision=1
     ~~~

9. 部署应用

   - ~~~sh
     kubectl apply -f xxx.yaml
     ~~~

     


