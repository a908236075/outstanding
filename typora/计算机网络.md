## 计算机网络

### 网络层

1. 将一个C类网址分成两个网段
   1. 主机部分不全为1或0, 全为零主机部分为零不能代表自己有ip,全为1主机部分为255,255被定义为广播了.全为1说的划分网段的时候二进制全为1,例如11111111这个代表127,所以这个网址规定为广播是不能被使用的.
   2. 每个网段的最后一位地址是广播地址不能用.
   3. 划分子网要遵循除以2的关系.每除以一次2子网掩码向前移动一位.
   
2. 超网 将两个分着的网段合并成一个网,叫做超网.

3. 数据传输的时候,数据包不变,数据帧由于记录了数据源和目的地的mac地址,每次请求都会变化.

4. ip地址决定了最终跳转到谁,mac地址决定了下一步跳转到谁.  

5. 计算机的网口不能加两个网关,联网时会导致将数据均衡的上报,导致上网的时候时断时同,丢掉一半的数据.

6. 网络请求的头部:

   ![image-20201201100213093](C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201201100213093.png)

7. 头部的各个部分的介绍

   - 版本:ipv6/4
   - 首部长度:首部一共的长度.
   - 区分服务:打上标记,数据是否着急.
   - 总长度:首部加上数据包一共有多少长度.
   - 标识:没产生一个数据报加一.
   - 片偏移:将大数据进行分包,分开包的首个字节数/8获取片偏移.
   - 生存时间:TTL发包的时候为128,每经过一次路由减掉1,防止在网络上一直重复的传递.
   - 协议号:用数字标记,例如17为UDP协议.
   - 首部校验和:校验首部数据是否有错误.是将首部中所有16位相加得到和后取反.

8. 网络层有四个协议：ARP协议，IP协议，ICMP协议，IGMP协议。ARP协议为IP协议提供服务，IP协议为ICMP协议提供服务，ICMP协议为IGMP协

   议提供服务。

9. ICMP协议:报错功能的协议,具有重定向的功能.

10. 动态路由协议: 动态的选择最佳路径.   RIP协议 周期性广播 30秒   根据跳数判断最佳的路径.

### 传输层

1. TCP协议

   1. 特点
      - Tcp面向连接的传输层协议.连接的时候会建立会话,是一个可靠的传输.
      - 点对点的通信,不像UDP那样一对多,多对多.套接字(ip地址加端口)代表一个点.
      - 提供双工的通信.为了确定接受者正常,需要收到反馈,所以需要双工通信.
      - 面向字节流.TCP缓存读取数据的时候,与网络发送字节数据没有关系
      - ![image-20201204102658025](C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201204102658025.png)
      
   2. 学习重点:可靠传输,流量控制,避免网络拥塞分别怎么实现.

   3. 可靠传输的工作原理
      1. 停止等待协议
         1. 无差错情况
         2. 超时重传
         3. 自动重传请求
         4. 缺点:信道利用率低.大部分时间都是在等待确认信息回来.
      2. 连续ARQ协议
         - 流水线传输:不用等待第一次发送回来的确认信息,就发第二个数据包.运用窗口技术
         - 累积确认:只发连续收到的最大的那个,发送1234 接收到了124  返回确认为2收到了.

   4. TCP报文段的首部格式

      ![image-20201204104116907](C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201204104116907.png)

      1. **序号**:数据段的第一字节是整个文档的第几个字节(序号字段值指的是本报文段所发送的数据的第一个字节的序号。)
      
      2. **确认号**:接受者等待发送者发送第几个字节的数据,这个字节之前的发送者可以认为都收到了.
      
      3. **数据偏移**:告诉计算机首部有多长,剩余的都是数据.首部最大60个字节,其中20字节为固定的部分,所以首部的选项最多为40个字节.
      
      4. **保留 Reserved**
      
         - **URG**：表示本报文段中发送的数据是否包含紧急数据。URG=1，表示有紧急数据。后面的紧急指针字段只有当URG=1时才有效。
         - **ACK**：表示是否前面的**确认号**字段是否有效。ACK=1，表示有效。只有当ACK=1时，前面的确认号字段才有效。TCP规定，连接建立后，ACK必须为1。为确定连接时为0.
         - **PSH**：告诉对方收到该报文段后是否应该立即把数据推送给上层。如果为1，则表示对方应当立即把数据提交给上层，而不是缓存起来。其实就是**接收端的URG**.
         - **RST**：只有当RST=1时才有用。如果你收到一个RST=1的报文，说明你与主机的连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接。或者说明你上次发送给主机的数据有问题，主机拒绝响应。reset单词.
         - **SYN**：在建立连接时使用，用来同步序号。当SYN=1，ACK=0时，表示这是一个请求建立连接的报文段；当SYN=1，ACK=1时，表示对方同意建立连接。SYN=1，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中SYN才置为1。
         - **FIN**：标记数据是否发送完毕。如果FIN=1，就相当于告诉对方：“我的数据已经发送完毕，你可以释放连接了”.
      
      5. **窗口大小**:表示现在运行对方发送的数据量。也就是告诉对方，从本报文段的确认号开始允许对方发送的数据量。告诉对方这次传输准备多大的缓存.(窗口会随着传输向数据的后方移动,窗口传输过的数据可以进行舍弃.)
      
      6.  **选项**    长度可变，最长可达4字节。当没有使用“选项”时，TCP的首部长度是20字节。
      
         ​    		TCP最初只规定了一种选项，即最大报文段长度MSS（Maximum Segment  Szie）。注意MSS这个名词含义。MSS是每一个TCP报文段中的数据字段的最大长度。数据字段加上TCP首部才等于整个的TCP报文段。所以MSS并不是整个TCP报文段的最大长度，而是“TCP报文段长度减去TCP首部长度” .
      
   5. TCP的可靠传输
      2. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205101929327.png" alt="image-20201205101929327" style="zoom: 80%;" />
      2. A的发送窗口大小是由B来决定的.
      3. 窗口会随着数据的传输向后移动,传输过的数据就可以从缓存中删除了. 
      4. 当发生数据丢失的时候,接收方在确认字段发送接收到的连续字段最大值,并通过SAK标记一起确定那一段的数据需要重新传.

   6. TCP的拥塞控制

      1. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205105905610.png" alt="image-20201205105905610" style="zoom: 50%;" />

   7. TCP的传输连接管理

      1. SYN_Send  ,LISTEN,SYN_Received ,ESTABLISHED,FIN-WAIT-1/2,TIME-WAIT,CLOSED 建立网络的集中状态.
      2. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205112428584.png" alt="image-20201205112428584" style="zoom:50%;" />
      3. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205112115019.png" alt="image-20201205112115019" style="zoom:50%;" />
      4. 

### 应用层

1. DNS服务
   1. 作用:域名解析,将网站转换为ip地址访问.
2. 文件传输协议File Transfer Protocol  
   - 使用两个FTP连接,一个是控制连接,一个是数据连接.
   - 主动模式和被动模式
   - Ftp服务端 如果有防火墙,需要开20和21端口,使用主动模式进行连接.
3. Web代理服务器

# 自顶向下

## 计算机网络和因特网

### 什么是因特网

#### 具体构成描述

1. 设备也称为主机或者端系统.
2. 端系统通过**通信链路**和**分组交换机**连接到一起.通信链路就是包括铜线,光纤.
3. 分组交换机:从它的一条入通信链路接收到达分组,并从它的条出通信链路转发改分组.路由器和链路层交换机.
4. 协议:TCP(Transmission Control Protocol) 传输控制协议,IP(Internet Protocol) 网际协议.

#### 服务描述

1. 从应用程序提供服务的基础设施的角度.
2. **套接字接口**(socket interface):规定了两个端系统交付数据的方式.

#### 什么是协议

1. 协议:定义了在两个或者多个通信实体之间交换报文的格式和顺序,以及报文发送和接收一条报文或者其他事件所采取的动作.

### 网络核心

1. 端系统彼此交换**报文**,为了从源端系统向目的端系统发送一个报文,源将长报文划分为较小的数据块,称之为**分组.**
2. **存储转发传输**:多数分组交换机在链路的输入端使用存储转发传输.仅当路由器已经接收完了该分组的所有比特后,它才能想出链路传输.所以一次传输会有L/R时间的延迟.
3. **排队时间**和**分组丢失**:如果发现链路正忙于传输其它分组,该到达分组必须在输出缓存中等待.所以除了转发延时外,还有输出缓存的**排队时延**.一个到达的分组如果发现该缓存已经被其他等待的分组完全充满,在此情况下将出现**分组丢失**.
4. **转发表**:每台路由器具有一个**转发表**,用于将目的地址映射成输出链路.当某分组到达一台路由器时,路由器检查改地址,并用这个目的地址搜索其转发表,以发现适当的出路由.像一个没有地图,一直问路的司机.
5. **路由选择协议**:基于此协议形成的转发表.
6. **电路交换**:预留了端系统间沿路径通信所需要的资源(另一种转发策略,与存储转发相对应).**频分复用和时分复用**,频分复用:将宽带分为不同的频率频道,时分复用:时间划分为固定期间的帧,并且每个帧又被划分为固定数量的时隙.

### 分组交换网中的时延,丢包和吞吐量

1. **节点处理时延,排队时延,传输时延,转播时延,这些时延总体累加起来是节点总时延.**
2. **处理时延**:检查分组首部和决定该分组导向何处所需要的时间是处理时延.**传播延时**:从该链路的起点到路由器B传播所需要的时间是传播时延,等于两台路由器的距离除以传播速率.
3. 排队延时:大小取决于流量是周期性的到达还是以突发性的形式到达.流量强度:La/R, a表示分组到达队列的平均速率.需要小于1.
4. 吞吐量:比特/秒

### 协议分层及其服务模型

1. 应用层,(表示层,会话层),运输层,网络层,链路层,物理层.

## 应用层

### 应用层协议原理

1. 运输层协议能够为他的应用程序提供什么样的服务:从四个方面对应用程序服务要求进行分类:可靠数据传输,吞吐量,定时和安全性.
2. TCP服务:
   1. 面向连接的服务:会发生握手. 2. 可靠的数据传送服务:

### Web和HTTP

1. 无状态协议:因为HTTP服务器并不保存关于客户的任何信息.

2. 常见的HTTP请求是连续性的请求,而不用向非连续性的请求那样每次都进行三次握手

3. HTTP请求报文

   1. ![](.\picture\计算机网络\Http报文的格式.png)
   2. 请求行:报文的第一行 包含方法字段,URL字段和HTTP版本字段.
   3. 首部行:Host:指明了对象所在的主机.Connection:close表示通信完成就关闭连接,不用向持续连接那样一直保持连接.User-agent:用户代理,即向服务器发送请求的浏览器类型.Accept-language:用户想得到该对象的语法版本.

4. HTTP响应报文

   1. ![](.\picture\计算机网络\Http响应报文.png)

   2. 状态行:协议版本字段 状态码 状态信息
   3. 首部行:
      1. Connection:close 发送完报文后将关闭该TCP连接.
      2. Date:是指服务器从它的文件系统中检索到该对象,将该对象插入响应报文,并发送该响应报文的时间.
      3. Server:指示该报文是由一台Apache Web服务器产生的.
      4. Last-Modified:对象创建或者最后修改的时间.
   4. 实体体:

5. Web缓存器:也叫代理服务器.代理服务器对用户来说是服务器,对真正的服务器来说是客户.

6. 条件Get方法:请求报文使用Get方法,并且请求报文中包含一个"If-Modified-Since" 首部行,后面是一个日期,表示Web服务器检查从此日期后是否有修改.

### 因特网中的电子邮件

1. SMTP协议:SMTP是一种推协议:即发送邮件服务器推向接收邮件服务器.而Http是一个拉的协议,即服务器已经将内容准备好,客户端进行拉取.SMTP采用的是一种直接连接的方式,不会采用中间的代理,不会将信息留存在接收方的服务器内,在自己的服务器中获取,以后再进行重试.

### DNS因特网的目录服务

1. 域名系统(Domain Name System):主要任务是将主机名(域名)转换为IP地址.
2. 为了避免单点故障,通信容量,远近距离的集中式数据库,以及维护问题,DNS采用分布式,层次数据库.
3. 所有DNS的请求和回答报文使用UDP数据报端口53发送.
4. DNS服务器的层次结构中有3种类型:根DNS服务器,顶级域DNS服务器和权威DNS服务器.还有一个钟是本地DNS服务器.

### 视频流和内容分发

1. DASH:HTTP的动态适应流.将视频编码为几个不同的版本,根据带宽动态的分配返回的视频质量(2k 1080P);
2. 内容分发网(CDN):管理多地理位置上的服务器,在它的服务器中存储视频的副本,根据请求返回一个更好的CDN位置.

## 运输层

### 多路复用和多路分解

1. 将主机间的交付扩展到进程间交付被称为运输层的**多路复用和多路分解**.将运输层报文段中的数据交付到正确的套接字的工作称为**多路分解**.在源主机从不同套接字中收集数据块,并为每个数据块封装上首部信息从而生成报文段,然后将报文段传递到网络层,所有这些工作称为**多路复用**.

### 拥塞控制原理

1. 发送拥塞的3中情况:容量R,
   - 第一种一台无线缓存的路由器,速率无线接近R/2
   - 第二有一台有限缓存的路由器,因为重传每个分组被路由器转发两次,供给负荷接近R/2,吞吐量接近R/4
   - 4台路由器都有缓存,两台直接的速率会随着另外两台所占用内存增大而减小.
2. 拥塞控制方法
   1. 由路由器直接发送反馈信息给发送方.不常用
   2. 路由器标记或者更新从发送方流向接受方分组的某个字段指示拥塞的产生,接收方发送拥塞的通知给发送方.

### TCP拥塞控制

1. 想要伸缩性的改变发送速率,要面临三个问题:TCP如何限制发送方的速率,第二TCP如何感知到拥塞.第三采用何种有效的算法改变发送速率.
2. 第一个问题:增加了一个变量拥塞窗口变量(cwnd),发送方中未被确认的数量不会超过发送窗口和拥塞窗口的较小值,速率根据cwnd/往返时间的起始点,第二个问题通过连接超时或者收到3个冗余的ack即认为有拥塞.第三个问题,通过自计时动态调解发送速率.
3. TCP拥塞控制算法包括:慢启动,拥塞避免,快速恢复.
   1. 慢启动:报文段被确认就增加一个报文,直到发现拥塞.
   2. 拥塞窗口是上次发生拥塞窗口的一半时,减慢速度只增加一个报文段.当发生超时,拥塞窗口被设置为一个报文段.
   3. 快速恢复:发生超时后,拥塞窗口被设置为一个报文段,从新进入到慢启动状态.早起版本发现拥塞后直接将报文段的发送降至1.
4. 拥塞回顾
   1. 每个RTT(请求应答时间)内,cwnd(拥塞窗口)线性的增加1MSS(报文段),然后出现3个冗余的ACK事件时,cwnd减半,常被称为加性增,乘性减.
   2. 一条连接的平均吞吐量=(0.75*窗口长度)/RTT;

### 公平性

1. 一条连接的平均吞吐量:(1.22*最大报文长度)/(往返时间 * √丢包率)

## 网络层:数据平面

### 网络层概述

1. 主机和路由器都有一个网络层部分,网络层分为数据平面和控制平面.数据平面就是路由器功能,

### 路由器工作原理

1. 交换:
   - 通过内存交换,如果输入输出的速率极限是B,则最大也就只能达到B/2
   - 总线交换:不需要路由选择处理器干预,直接由共享总线连接输入与输出端口.
   - 互联网交换:纵横式,输入端口和删除端口的总线组成一个横纵交错的网状结构,是一种非阻塞的交换方式.经常用到.
2. 排队:路由器会在输入端口和输出端口出现排队,如果排队数量较多就出现丢包.如果输入端口到输出端口**移动分组的速率**比**输入线路速度**小,在输入端口处就会形成队列.

### 网络协议

1. IPv4数据报分片
   1. 最大传送单元(MTU):一个链路层帧能承载的最大数据量.由于路由器能够发送的最大数据小于传送单元,所以需要将ip数据报进行拆分,这些较小的数据报被称为片.
   2. 以片发送的数据需要进行重新的组装,IPv4设计了**标识,标志和片偏移字段**放在了IP数据报首部.
      - 标识:同一个ip数据报的分片标识相同,为了区分不同的ip数据报的分片.标识号是递增的.
      - 标志:为了让目的主机知道收到数据的最后一个片,最后一片的标志设置为0,其余设置为1.
      - 偏移字段:为了让目的主机确认是否丢失了一个片,偏移字段指定该片放在数据报的哪个位置.

2. IPv4编址
   1. 子网:前24位相同的ip,会组建一个子网.
      1. 无类别域间路由选择:32比特的IP地址被划分为两部分,并且也具有点分十进制数形式a.b.c.d/x,其中x指定了地址第一部分中的比特数.由x构成ip地址的网络部分,并且经常被称之为该地址的**前缀**.
      2. 如果ip地址为255.255.255.255称为**广播地址**,发送该ip的报文会传递给同一网络中的所有主机.

   2. 动态主机配置协议:DHCP:除了主机IP地址分配外,还允许一台主机得知其它信息,例如子网掩码,它的第一跳路由器地址(常称为默认网关),与它的本地DNS服务器的地址.

## 网络层: 控制平面

### 概述

1. 每路由器控制:每台路由器控制着自己的跳转逻辑
2. 逻辑集中式控制:由统一的服务器进行控制,服务器不止一台.(常用的技术)

### 路由选择算法

# 面试题

1. 







