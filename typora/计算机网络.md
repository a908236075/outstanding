## 计算机网络

### 网络层

1. 将一个C类网址分成两个网段
   1. 主机部分不全为1或0, 全为零主机部分为零不能代表自己有ip,全为1主机部分为255,255被定义为广播了.全为1说的划分网段的时候二进制全为1,例如11111111这个代表127,所以这个网址规定为广播是不能被使用的.
   2. 每个网段的最后一位地址是广播地址不能用.
   3. 划分子网要遵循除以2的关系.每除以一次2子网掩码向前移动一位.
   
2. 超网 将两个分着的网段合并成一个网,叫做超网.

3. 数据传输的时候,数据包不变,数据帧由于记录了数据源和目的地的mac地址,每次请求都会变化.

4. ip地址决定了最终跳转到谁,mac地址决定了下一步跳转到谁.  

5. 计算机的网口不能加两个网关,联网时会导致将数据均衡的上报,导致上网的时候时断时同,丢掉一半的数据.

6. 网络请求的头部:

   ![image-20201201100213093](C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201201100213093.png)

7. 头部的各个部分的介绍

   - 版本:ipv6/4
   - 首部长度:首部一共的长度.
   - 区分服务:打上标记,数据是否着急.
   - 总长度:首部加上数据包一共有多少长度.
   - 标识:没产生一个数据报加一.
   - 片偏移:将大数据进行分包,分开包的首个字节数/8获取片偏移.
   - 生存时间:TTL发包的时候为128,每经过一次路由减掉1,防止在网络上一直重复的传递.
   - 协议号:用数字标记,例如17为UDP协议.
   - 首部校验和:校验首部数据是否有错误.

8. 网络层有四个协议：ARP协议，IP协议，ICMP协议，IGMP协议。ARP协议为IP协议提供服务，IP协议为ICMP协议提供服务，ICMP协议为IGMP协

   议提供服务。

9. ICMP协议:报错功能的协议,具有重定向的功能.

10. 动态路由协议: 动态的选择最佳路径.   RIP协议 周期性广播 30秒   根据跳数判断最佳的路径.

### 传输层

1. TCP协议

   1. 特点
      - Tcp面向连接的传输层协议.连接的时候会建立会话,是一个可靠的传输.
      - 点对点的通信,不像UDP那样一对多,多对多.套接字(ip地址加端口)代表一个点.
      - 提供双工的通信.为了确定接受者正常,需要收到反馈,所以需要双工通信.
      - 面向字节流.TCP缓存读取数据的时候,与网络发送字节数据没有关系
      - ![image-20201204102658025](C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201204102658025.png)
      
   2. 学习重点:可靠传输,流量控制,避免网络拥塞分别怎么实现.

   3. 可靠传输的工作原理
      1. 停止等待协议
         1. 无差错情况
         2. 超时重传
         3. 自动重传请求
         4. 缺点:信道利用率低.大部分时间都是在等待确认信息回来.
      2. 连续ARQ协议
         - 流水线传输:不用等待第一次发送回来的确认信息,就发第二个数据包.运用窗口技术
         - 累积确认:只发连续收到的最大的那个,发送1234 接收到了124  返回确认为2收到了.

   4. TCP报文段的首部格式

      ![image-20201204104116907](C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201204104116907.png)

      1. **序号**:数据段的第一字节是整个文档的第几个字节(序号字段值指的是本报文段所发送的数据的第一个字节的序号。)
      
      2. **确认号**:接受者等待发送者发送第几个字节的数据,这个字节之前的发送者可以认为都收到了.
      
      3. **数据偏移**:告诉计算机首部有多长,剩余的都是数据.首部最大60个字节,其中20字节为固定的部分,所以首部的选项最多为40个字节.
      
      4. **保留 Reserved**
      
         - **URG**：表示本报文段中发送的数据是否包含紧急数据。URG=1，表示有紧急数据。后面的紧急指针字段只有当URG=1时才有效。
         - **ACK**：表示是否前面的**确认号**字段是否有效。ACK=1，表示有效。只有当ACK=1时，前面的确认号字段才有效。TCP规定，连接建立后，ACK必须为1。为确定连接时为0.
         - **PSH**：告诉对方收到该报文段后是否应该立即把数据推送给上层。如果为1，则表示对方应当立即把数据提交给上层，而不是缓存起来。其实就是**接收端的URG**.
         - **RST**：只有当RST=1时才有用。如果你收到一个RST=1的报文，说明你与主机的连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接。或者说明你上次发送给主机的数据有问题，主机拒绝响应。reset单词.
         - **SYN**：在建立连接时使用，用来同步序号。当SYN=1，ACK=0时，表示这是一个请求建立连接的报文段；当SYN=1，ACK=1时，表示对方同意建立连接。SYN=1，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中SYN才置为1。
         - **FIN**：标记数据是否发送完毕。如果FIN=1，就相当于告诉对方：“我的数据已经发送完毕，你可以释放连接了”.
      
      5. **窗口大小**:表示现在运行对方发送的数据量。也就是告诉对方，从本报文段的确认号开始允许对方发送的数据量。告诉对方这次传输准备多大的缓存.(窗口会随着传输向数据的后方移动,窗口传输过的数据可以进行舍弃.)
      
      6.  **选项**    长度可变，最长可达4字节。当没有使用“选项”时，TCP的首部长度是20字节。
      
         ​    		TCP最初只规定了一种选项，即最大报文段长度MSS（Maximum Segment  Szie）。注意MSS这个名词含义。MSS是每一个TCP报文段中的数据字段的最大长度。数据字段加上TCP首部才等于整个的TCP报文段。所以MSS并不是整个TCP报文段的最大长度，而是“TCP报文段长度减去TCP首部长度” .
      
   5. TCP的可靠传输
      2. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205101929327.png" alt="image-20201205101929327" style="zoom: 80%;" />
      2. A的发送窗口大小是由B来决定的.
      3. 窗口会随着数据的传输向后移动,传输过的数据就可以从缓存中删除了. 
      4. 当发生数据丢失的时候,接收方在确认字段发送接收到的连续字段最大值,并通过SAK标记一起确定那一段的数据需要重新传.

   6. TCP的拥塞控制

      1. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205105905610.png" alt="image-20201205105905610" style="zoom: 50%;" />

   7. TCP的传输连接管理

      1. SYN_Send  ,LISTEN,SYN_Received ,ESTABLISHED,FIN-WAIT-1/2,TIME-WAIT,CLOSED 建立网络的集中状态.
      2. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205112428584.png" alt="image-20201205112428584" style="zoom:50%;" />
      3. <img src="C:\Users\b9082\AppData\Roaming\Typora\typora-user-images\image-20201205112115019.png" alt="image-20201205112115019" style="zoom:50%;" />
      4. 

### 应用层

1. DNS服务
   1. 作用:域名解析,将网站转换为ip地址访问.
2. 文件传输协议File Transfer Protocol  
   - 使用两个FTP连接,一个是控制连接,一个是数据连接.
   - 主动模式和被动模式
   - Ftp服务端 如果有防火墙,需要开20和21端口,使用主动模式进行连接.
3. Web代理服务器