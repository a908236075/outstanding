### 大型网站技术架构

1. 大型网站架构演化发展历程

   1. 初始阶段:应用程序,数据库,文件都在一台服务器上.
   2. 应用程序和数据库分离:需要应用程序服务器,文件服务器和数据库服务器.
   3. 使用缓存改善网站性能:将经常读取的数据放到缓存中.
   4. 数据库读写分离.
   5. 使用反向代理和CDN加速网站响应.他们的基本原理都是缓存,CDN部署在网络提供商的机房,用户请求网站可以从最近的机房获取数据.反向代理部署在网站中心机房,当用户的请求到达中心机房后,首先访问的是反向代理服务器,如果反向代理服务器中缓存中用户请求的资源,就将其直接返回给用户.
   6. 使用分布式文件系统和分布式数据库系统:分布式数据库是网站数据库拆分的最后手段,只有单表数据规模非常庞大的时候才使用.
   7. 使用nosql和搜索引擎.
   8. 业务拆分:将一个网站拆分成许多不同的应用.
   9. 分布式系统

2. 大型网站架构模式

   1. 分层:应用层,服务层(为应用层提供服务支持,如用户管理,购物车服务等),数据层.
   2. 分割:纵方向上对软件进行切分.将功能和服务分割,包装成高内聚低耦合的模块单元.
   3. 分布式:①分布式应用和服务②分布式静态资源③分布式数据和存储④分布式计算
   4. 集群
   5. 缓存:CDN和反向代理.
   6. 异步:消息队列.
   7. 冗余:数据库出现故障,会有备份的数据库继续提供服务.
   8. 自动化:自动化部署,自动化代码管理,自动化安全监测.
   9. 安全:密码和手机验证码.

3. 大型网站核心架构要素

      性能,可用性,伸缩性,扩展性,安全性.

4. 网站的高性能架构

   1. 性能测试指标:响应时间,并发数,吞吐量,性能计数器
   2. Web前端性能优化
      - 减少http请求:合并CSS,合并JavaScript,合并图片.
      - 使用浏览器缓存:将CSS,js,图标这些静态资源的文件放入到浏览器的缓存中.
      - 启用压缩:启用Gzip压缩.
      - CSS放在页面最上面,JavaScript放在页面最下面.CSS需要下载.
      - 减少Cookie传输:
   3. CDN加速
   4. 反向代理

5. 应用服务器性能优化

      1. 分布式缓存
            - 合理的使用缓存:频繁的修改的数据,没有热点访问的数据,数据不一致与脏读,缓存可用性(大量的数据请求数据库,导致雪崩),缓存预热,缓存穿透(持续高并发的请求某一个不存在的数据,导致数据库崩溃)
            - 分布式缓存架构:
              - 以Memcached为代表的不互相通信的分布式缓存(大型网站)
              - 以JBoss Cache需要更新同步的分布式缓存.(性能不好,多用于企业应用系统)
      2. 异步操作:消息队列.
      3. 使用集群:web集群
      4. 代码优化
            - 多线程:启动线程数=[任务执行时间/(任务执行时间-IO等待时间)]×CPU内核数
            - 解决线程安全的手段:
                 - 对象设计成无状态的对象.本身不存储状态信息
                 - 使用局部对象
                 - 并发访问资源时使用锁
      5. 资源复用:尽量减少开销很大的系统资源的创建和销毁,例如数据库连接,线程,复杂对象.编程的角度:单例和对象池.

6. 网站的高可用架构

      1. 高可用的应用:
         1. 通过负载均衡进行无状态服务的失效管理.
         2. 应用服务器集群的Session管理.
            - 针对有状态的服务,想要实现负载均衡,必须保证所有的服务器多保存着相同的session.传统企业服务通过Session复制实现,简单但是并不高效,
            - Session绑定,通过算法实现更具Cookie就能找到对应的服务器,但是没有到达高性能的目的.
            - Session服务器,通过Session服务器区分有状态和无状态的应用服务器.
      2. 高可用服务器
         1. 分级管理:将服务器进行分级,将好的资源分配到订单这种重要的系统上.
         2. 超时设置:超时后第一时间将请求转移到可用的服务器上.
         3. 异步调用.
         4. 服务降级.大量并发调用使性能下降,可以将非核心业务进行降级.
         5. 幂等性设计:服务层保证服务重复调用和调用一次产生的结果相同.对于转账需要通过交易编号等信息进行服务的调用有效性校验.
      3. 高可用的数据
         1. CAP原理:为了保证网站的高可用,一般会牺牲数据的一致性.三个属性无法同时兼顾.
            1. C:数据的一致性,所有应用程都能访问到相同的数据.
            2. A:数据的可用性,任何时候,任何应用程序都可以读写访问.
            3. P:分区耐受性:系统可以跨网络分许线性伸缩.
         2. 数据一致性分类
            1. 数据强一致
            2. 数据用户一致:数据在物理存储中的各个副本的数据可能是不一致的,但是终端用户访问时,通过纠错和校验机制,可以确定一个一致的且正确的数据返回给用户.
            3. 数据最终一致:较弱的一种,但系统经过一段时间的自我恢复和修正,会达到一致性.
         3. 数据备份
            1. 数据冷备份:简单 但不能保证数据最终一致.
            2. 热备:异步热备方式和同步热备方式: